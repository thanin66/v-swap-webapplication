{% for chat in chat_list %}
    <a href="{% url 'chat_room' chat.friend.id %}" 
       class="flex items-center gap-3 p-4 hover:bg-gray-50 transition border-b border-gray-50 group
              {% if chat.is_active %}bg-blue-50 border-l-4 border-l-blue-500{% endif %}">
        
        <div style="width: 45px; height: 45px;" class="relative flex-shrink-0 rounded-full bg-gray-200 overflow-hidden">
            {% if chat.friend.userprofile.profile_picture %}
                <img src="{{ chat.friend.userprofile.profile_picture.url }}" style="width: 100%; height: 100%; object-fit: cover;">
            {% else %}
                <img src="https://ui-avatars.com/api/?name={{ chat.friend.username }}&background=random" style="width: 100%; height: 100%; object-fit: cover;">
            {% endif %}
        </div>

        <div class="flex-1 min-w-0"> 
            <div class="flex justify-between items-baseline mb-1">
                <h3 class="text-sm font-semibold text-gray-900 truncate">{{ chat.friend.username }}</h3>
                {% if chat.timestamp %}
                    <span class="text-[10px] text-gray-400">{{ chat.timestamp|date:"H:i" }}</span>
                {% endif %}
            </div>
            
            <div class="flex justify-between items-center">
                <p class="text-xs truncate pr-2 {% if chat.unread_count > 0 %}font-bold text-gray-800{% else %}text-gray-500{% endif %}">
                    {% if chat.friend.id == request.user.id %}
                        Note to self
                    {% else %}
                        {{ chat.last_message|truncatechars:20 }}
                    {% endif %}
                </p>

                {% if chat.unread_count > 0 %}
                    <span class="bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[18px] text-center shadow-sm">
                        {{ chat.unread_count }}
                    </span>
                {% endif %}
            </div>
        </div>
    </a>
{% empty %}
    <div class="p-10 text-center text-gray-400 text-sm">
        <p>No messages yet.</p>
    </div>
{% endfor %}