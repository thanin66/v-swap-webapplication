{% extends "base.html" %}

{% block title %}{{ post.title }} | VSwap{% endblock %}

{% block content %}
<main class="max-w-6xl mx-auto mt-10 px-4">

    <div class="bg-white shadow-xl rounded-2xl overflow-hidden">

        <!-- Layout: Left image — Right details -->
        <div class="grid grid-cols-1 md:grid-cols-2">

            <!-- Left: Product Image -->
            <div class="bg-gray-50 flex items-center justify-center p-4">
                {% if post.image %}
                    <img src="{{ post.image.url }}" 
                        alt="{{ post.title }}" 
                        class="max-w-xl w-full mx-auto rounded-lg mb-4 shadow">
                {% else %}
                    <div class="text-gray-400">No Image</div>
                {% endif %}
            </div>

            <!-- Right: Title + Info -->
            <div class="p-6 space-y-5">

                <h2 class="text-3xl font-extrabold text-gray-800">{{ post.title }}</h2>

                <p class="text-gray-600 leading-relaxed">
                    {{ post.description }}
                </p>

                <!-- Post type info -->
                <div class="mt-4 bg-gray-100 p-4 rounded-xl text-sm leading-relaxed space-y-2">
                    {% if post.post_type == 'swap' %}
                        <p><span class="font-semibold">ประเภท:</span> แลกของ</p>
                        <p><strong>รายละเอียดของที่ต้องการแลก:</strong> {{ post.swap_item_description }}</p>

                    {% elif post.post_type == 'buy_sell' %}
                        <p><span class="font-semibold">ประเภท:</span> ขาย / รับซื้อ</p>
                        <p><strong>ราคา:</strong> {{ post.price }} บาท</p>

                    {% elif post.post_type == 'donation' %}
                        <p><span class="font-semibold">ประเภท:</span> ให้ฟรี</p>
                        <p><strong>สภาพ/รายละเอียด:</strong> {{ post.condition }}</p>
                    {% endif %}
                </div>

                <!-- Owner / Contact -->
                <div class="flex items-center space-x-4 border-t pt-4">
                    <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center text-xl font-bold text-blue-700 shadow">
                        {{ post.owner.username|slice:":1"|upper }}
                    </div>
                    <div>
                        <p class="font-semibold">ผู้โพสต์: {{ post.owner.username }}</p>
                        <p class="text-gray-500 text-sm">ติดต่อได้ผ่านระบบแชท</p>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="mt-4 flex flex-wrap gap-3">

                    {% if post.owner == user %}
                        <a href="{% url 'post_edit' post.id %}"
                           class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg shadow transition">
                           แก้ไขโพสต์
                        </a>

                        <form method="post" action="{% url 'post_delete' post.id %}">
                            {% csrf_token %}
                            <button type="submit"
                                    class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg shadow transition">
                                ลบโพสต์
                            </button>
                        </form>
                    {% else %}
                            {% if post.get_post_type_display == "แลกของ" or post.get_post_type_display == "swap" %}
                                <a href="{% url 'send_request' post.id %}" class="w-full text-center bg-green-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-900 transition duration-200 ease-in-out transform hover:scale-105">
                                    ส่งคำขอ
                                </a>
                            {% elif post.get_post_type_display == "ขาย/รับซื้อ" or post.get_post_type_display == "buy_sell" %}
                                <a href="{% url 'send_request' post.id %}" class="w-full text-center bg-yellow-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-yellow-900 transition duration-200 ease-in-out transform hover:scale-105">
                                    ส่งคำขอ
                                </a>
                            {% elif post.get_post_type_display == "ให้ฟรี" or post.get_post_type_display == "donate" %}
                                <a href="{% url 'send_request' post.id %}" class="w-full text-center bg-purple-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-900 transition duration-200 ease-in-out transform hover:scale-105">
                                    ส่งคำขอ
                                </a>
                            {% endif %}
                    {% endif %}

                </div>
            </div>
        </div>

            {% if post.leaflet_lat and post.leaflet_lng %}
                <div id="map" class="w-full h-96 rounded-lg shadow mb-4"></div>
            {% endif %}

    </section>



</main>

{% if post.leaflet_lat and post.leaflet_lng %}
<script>
    var map = L.map('map').setView([{{ post.leaflet_lat }}, {{ post.leaflet_lng }}], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    L.marker([{{ post.leaflet_lat }}, {{ post.leaflet_lng }}])
        .addTo(map)
        .bindPopup("<b>{{ post.title }}</b><br>{{ post.description|truncatechars:50 }}")
        .openPopup();
</script>


{% endif %}
{% endblock %}
